SET (LIBRARY_OUTPUT_PATH ${SGE_PLUGIN_BUILD_PATH})

FIND_PACKAGE(DevIL)
FIND_PACKAGE(D3D9)
FIND_PACKAGE(DInput)
FIND_PACKAGE(Freetype)
FIND_PACKAGE(Iconv)
FIND_PACKAGE(GLEW)
FIND_PACKAGE(OpenGL)
FIND_PACKAGE(OpenAL)
FIND_PACKAGE(PNG 1.4.1)
FIND_PACKAGE(Vorbis)

# These plugins have no dependencies
OPTION (ENABLE_AUDIO_NULL "Build the null audio player plugin" OFF)

OPTION (ENABLE_WAVE "Build the wave loader plugin" ON)


OPTION (ENABLE_D3D9 "Build the d3d9 render plugin" ${D3D9_FOUND})

OPTION (ENABLE_DEVIL "Build the devil image loader plugin" ${IL_FOUND})

OPTION (ENABLE_DINPUT "Build the direct input 8 plugin" ${DINPUT_FOUND})

OPTION (ENABLE_ICONV "Build the iconv conversion plugin" ${ICONV_FOUND})

OPTION (ENABLE_WINCONV "Build the winconv conversion plugin" ${WIN32})

OPTION (ENABLE_FREETYPE "Build the freetype font plugin" ${FREETYPE_FOUND})

OPTION (ENABLE_OPENAL "Build the openal audio plugin" ${OPENAL_FOUND})

IF(
	OPENGL_FOUND AND GLEW_FOUND
)
	SET(
		OPENGL_AVAILABLE
		TRUE
	)
ELSE()
	SET(
		OPENGL_AVAILABLE
		FALSE
	)
ENDIF()

OPTION (ENABLE_OPENGL "Build the opengl render plugin" ${OPENGL_AVAILABLE})

OPTION (ENABLE_PNG "Build the libpng plugin" ${PNG_FOUND})

OPTION (ENABLE_VORBIS "Build the vorbis loader plugin" ${VORBIS_FOUND})

OPTION (ENABLE_X11INPUT "Build the x11 input plugin" ${X11_Xinput_FOUND})


function(
	ADD_SGE_PLUGIN
	PLUGIN_NAME
	SGE_DEPS
	ADDITONAL_DEPS
)
	set(
		SGE_PLUGIN_NAME
		sge${PLUGIN_NAME}
	)

	string(
		TOUPPER
		${PLUGIN_NAME}
		UPPER_PLUGIN_NAME
	)

	FCPPT_UTILS_APPEND_SOURCE_DIR_AND_MAKE_GROUPS(
		"${SGE_${UPPER_PLUGIN_NAME}_FILES}"
		SGE_${UPPER_PLUGIN_NAME}_FILES_ABS
	)

	add_library(
		${SGE_PLUGIN_NAME}
		SHARED
		${SGE_${UPPER_PLUGIN_NAME}_FILES_ABS}
	)

	transform_sge_link_targets(
		"${SGE_DEPS}"
	)

	if(
		SGE_DEFAULT_LINK_STATIC
	)
		sge_set_static_flags(
			${SGE_PLUGIN_NAME}
		)
	endif()

	check_library_deps(
		"${PLUGIN_NAME}"
		"${SGE_DEPS}"
	)

	target_link_libraries(
		${SGE_PLUGIN_NAME}
		${ADDITONAL_DEPS}
		${SGELIBS_TARGETS_RESULT}
	)

	install(
		TARGETS
		${SGE_PLUGIN_NAME}
		DESTINATION
		${PLUGIN_INSTALL_DIR}
	)
endfunction()

IF(ENABLE_AUDIO_NULL)
	ADD_SUBDIRECTORY (audio_null)
ENDIF ()

IF(ENABLE_D3D9)
	ADD_SUBDIRECTORY (d3d9)
ENDIF ()

IF (ENABLE_DEVIL)
	ADD_SUBDIRECTORY (devil)
ENDIF ()

IF (ENABLE_DINPUT)
	ADD_SUBDIRECTORY (dinput)
ENDIF ()

IF (ENABLE_FREETYPE)
	ADD_SUBDIRECTORY (freetype)
ENDIF ()

IF (ENABLE_ICONV)
	ADD_SUBDIRECTORY (iconv)
ENDIF ()

IF (ENABLE_OPENAL)
	ADD_SUBDIRECTORY (openal)
ENDIF ()

IF (ENABLE_OPENGL)
	ADD_SUBDIRECTORY (opengl)
ENDIF ()

IF (ENABLE_PNG)
	ADD_SUBDIRECTORY (libpng)
ENDIF ()

IF (ENABLE_VORBIS)
	ADD_SUBDIRECTORY (vorbis)
ENDIF ()

IF (ENABLE_WAVE)
	ADD_SUBDIRECTORY (wave)
ENDIF ()

IF (ENABLE_WINCONV)
	ADD_SUBDIRECTORY (winconv)
ENDIF ()

IF (ENABLE_X11INPUT)
	ADD_SUBDIRECTORY (x11input)
ENDIF ()
